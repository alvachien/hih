
<!-- Content area of Finance Report: Daily balance Page begins -->
<h2 style="clear: both;" data-i18n="Finance.DailyBalanceReport">Finance
	Report: Daily Balance Report</h2>

<div>
	<p>Daily Balance Report, and you can select the period as well.</p>
</div>


<div id="p" class="easyui-panel" title="Grpahics" noheader="true"
	style="width: 100%; height: 400px; padding: 10px; background: #fafafa;">
	<div style="float: left; width: 50%;">
		<div id="inPiecontainer"
			style="min-width: 310px; height: 360px; max-width: 600px; margin: 0 auto"></div>
	</div>

	<div style="float: left; width: 50%;">
		<div id="outPiecontainer"
			style="min-width: 310px; height: 360px; max-width: 600px; margin: 0 auto"></div>
	</div>
</div>

<!-- Data grid  -->
<table id="dg" class="easyui-datagrid"
	title="Finance Daily Balance Sheet" style="width: 100%; height: 600px;"
	data-options="singleSelect:true,
<!-- 							url:'finance_report_dailybalance.php?TYPE=10', method:'get',  -->
							rownumbers: true,
							noheader: true"
	toolbar="#toolbar">
	<thead>
		<tr>
			<th data-options="field:'trantypeid', align:'right'" width="5%"><span
				data-i18n="Common.ID">Tran Type</span></th>
			<th
				data-options="field:'trantypeexpense', align:'right', formatter:formatExpenseFlag"
				width="5%"><span data-i18n="Finance.ExpenseFlag">Expense
					flag</span></th>
			<th data-options="field:'trantypename', align:'center'" width="30%"><span
				data-i18n="Finance.TransactionType">Tran Type</span></th>
			<th data-options="field:'trantamount', align:'right'" width="30%"><span
				data-i18n="Finance.Amount">Amount</span></th>
			<th data-options="field:'precent',align:'right'" width="20%"><span
				data-i18n="Common.Precent">Precent</span></th>
		</tr>
	</thead>
</table>

<!-- Toolbar of Datagrid -->
<div id="toolbar">
	<input id="dateValidfrom" type="text" class="easyui-datebox"
		name="validfrom" style="width: 120px; height: 30px; padding: 12px"
		data-options="formatter:dateformatter, parser:dateparser"></input> <input
		id="dateValidto" type="text" class="easyui-datebox" name="validfrom"
		style="width: 120px; height: 30px; padding: 12px"
		data-options="formatter:dateformatter, parser:dateparser"></input> <a
		href="javascript:void(0)" class="easyui-linkbutton"
		iconCls="icon-reload" plain="true" onclick="refreshItem()"><span
		data-i18n="Common.Refresh">Refresh</span> </a> <span> |</span>
</div>

<script>
	function formatExpenseFlag(val, row){
        return finExpenseFlag(val);
	}
	function refreshItem() {
		var validfrom = $('#dateValidfrom').datebox('getValue');
		var validto = $('#dateValidto').datebox('getValue');
		
		$('#dg').datagrid('load',{
	        fromdate: validfrom,
	        todate: validto
	    });		
	}
	
	// For multiple languages
	function i18npostprocess(lang) {
		// Titles for dialogs
		//var titleStr = i18n.t("Learn.CreateLearningObjectTitle");
		//$('#dlgCreate').dialog("setTitle", titleStr);
	}
	
	// Loading the data
	var arInc = [];
	var arOut = [];
	$.ajax({
		type: "GET",
		url: "finance_report_dailybalance.php",
		data: 
		{
			TYPE: 10
		}
	})
	.done(function(data) {
		var data2 = JSON && JSON.stringify(data);	
		jsonData = JSON && JSON.parse(data2) || $.parseJSON(data2);
		
		// Load ata
		$('#dg').datagrid('loadData', jsonData);
		
		jQuery.each(jsonData, function() {
			// Return false will stop the iterating...
			var obj = {
				'name': this.trantypename,
				'y': this.precent
			};
			
			if (this.trantypeexpense === 0) {
				arInc.push(obj);
			} else if (this.trantypeexpense === 1) {
				arOut.push(obj);
			}
			});
		buildCharts();
	})
	.fail(function(msg) {
		 $.messager.alert('Error', msg, 'error');
	});		
	
	// Build up the charts
	function buildCharts() {
		var options = {
		         chart: {
		             plotBackgroundColor: null,
		             plotBorderWidth: null,
		             plotShadow: false
		         },
		         title: {
		         },
		         tooltip: {
		             pointFormat: '{series.name}: <b>{point.percentage:.2f}%</b>'
		         },
		         plotOptions: {
		             pie: {
		                 allowPointSelect: false,
		                 cursor: 'pointer',
		                 dataLabels: {
		                     enabled: false
		                 },
		                 showInLegend: true
		             }
		         },
	            series: [{
	                type: 'pie',
	                data: []
	            }]
		    };
		options.title.text = i18n.t("Finance.Incoming");
		options.series[0].name = i18n.t("Finance.Incoming");
		options.series[0].data = arInc;
		$('#inPiecontainer').highcharts(options);
		
		var options2 = {
		         chart: {
		             plotBackgroundColor: null,
		             plotBorderWidth: null,
		             plotShadow: false
		         },
		         title: {
		         },
		         tooltip: {
		             pointFormat: '{series.name}: <b>{point.percentage:.2f}%</b>'
		         },
		         plotOptions: {
		             pie: {
		                 allowPointSelect: false,
		                 cursor: 'pointer',
		                 dataLabels: {
		                     enabled: false
		                 },
		                 showInLegend: true
		             }
		         },
	            series: [{
	                type: 'pie',	                
	                data: []
	            }]
		    };
		options2.title.text = i18n.t("Finance.Outgoing");
		options2.series[0].name = i18n.t("Finance.Outgoing");
		options2.series[0].data = arOut;
		$('#outPiecontainer').highcharts(options2);
	}
	</script>
<!-- Content area of Finance Report: Daily balance Page ends -->


